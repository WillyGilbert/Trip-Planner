"use strict";function getLocationsList(n,o){var t=49.766204,e=49.99275,a=-96.953987,c="".concat(-97.325875,",").concat(t,",").concat(a,",").concat(e);fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(n,".json?access_token=").concat("pk.eyJ1IjoibWlsaXRvbSIsImEiOiJja2E2YmtpN2cwNmhzMnlvejA0cm5kamtpIn0.DvZmdFkPPyBWuuW-TgOpTw","&limit=10&bbox=").concat(c)).then(function(t){if(t.ok)return t.json();throw Error(t.statusText)}).then(function(t){var e=[];0!==t.features.length?(t.features.forEach(function(t){e.push({name:t.place_name.split(",")[0],area:t.place_name.split(",")[1].trim(),long:t.center[0],lat:t.center[1]})}),drawLocationsList(e,o)):canNotFindLocation(n,o)}).catch(function(t){console.log(t)})}function canNotFindLocation(t,e){var n="at Starting Location";"origins"!==e&&(n="at Destination");var o="We can't find \"".concat(t," ").concat(n,'". Make sure your search is spelled correctly.');document.querySelector(".bus-container").innerHTML='<ul class="my-trip wrong-location">'.concat(o,".</ul>"),document.querySelector(".".concat(e)).innerHTML=""}function drawLocationsList(t,e){var n=document.querySelector(".".concat(e));document.querySelector(".bus-container").innerHTML="",n.innerHTML="",t.forEach(function(t){n.innerHTML+='\n    <li data-long="'.concat(t.long,'" data-lat="').concat(t.lat,'">\n      <div class="name">').concat(t.name,"</div>\n      <div>").concat(t.area,"</div>\n    </li>\n    ")})}function getTripPlans(t,e,n,o){var a="geo/".concat(t,",").concat(e),c="geo/".concat(n,",").concat(o),r=document.querySelector(".bus-container");r.innerHTML="",fetch("https://api.winnipegtransit.com/v3/trip-planner.json?api-key=".concat("5yygnE3Lb4Cl0NgfrQgk","&origin=").concat(a,"&destination=").concat(c)).then(function(t){return t.ok?t.json():void canNotTrips("There are currently no trips available between these two locations. Please try later")}).then(function(t){var e=0;if(0!==t.plans.length)for(;e<t.plans.length&&e<3;)getTripPlanSegment(r,e,t.plans[e++].segments);else canNotTrips("There are currently no trips available between these two locations. Please try later")}).catch(function(t){console.log(t)})}function canNotTrips(t){document.querySelector(".bus-container").innerHTML='<ul class="my-trip wrong-location">'.concat(t,".</ul>")}function getTripPlanSegment(t,e,n){var o="trip-number",a="Recommended Trip";0<e&&(o+=e,a="Alternative trip Number ".concat(e)),t.innerHTML+='<ul class="my-trip '.concat(o,'"> <strong>').concat(a,"</strong></ul>");var c=document.querySelector(".".concat(o));n.forEach(function(t){var e,n,o;"walk"===t.type&&(e="your destination",n="to ",void 0!==t.to&&void 0!==t.to.stop&&(e="- ".concat(t.to.stop.name),n="to stop #".concat(t.to.stop.key)),drawTripPlanSegment(c,"walk","".concat(t.type," for ").concat(getTime(t.times.durations.total)," ").concat(n," ").concat(e,"."))),"ride"===t.type&&(o="",o=void 0===t.route.name?t.route.number:t.route.name,drawTripPlanSegment(c,"ride","".concat(t.type," the ").concat(o," for ").concat(getTime(t.times.durations.total),"."))),"transfer"===t.type&&drawTripPlanSegment(c,"transfer","".concat(t.type," from stop #").concat(t.from.stop.key," - ").concat(t.from.stop.name," to stop #").concat(t.to.stop.key," - ").concat(t.to.stop.name,"."))})}function drawTripPlanSegment(t,e,n){t.innerHTML+='\n    <li>\n    <i class="'.concat(getIconClass(e),'" aria-hidden="true"></i>').concat(n.capitalize(),"\n    </li>\n  ")}function getIconClass(t){return{walk:"fas fa-walking",ride:"fas fa-bus",transfer:"fas fa-ticket-alt"}[t]}function getTime(t){var e=0,n=getMinutes(t);return 59<t?(e=Math.floor(t/60),e+=1<e?" hours":" hour",""!==n&&(e+="and "+n),e):getMinutes(t)}function getMinutes(t){var e=t%60;return 0===e?"less than one minute":e+=1<e?" minutes":" minute"}function main(){addEventForm("origin"),addEventForm("destination"),document.querySelector(".plan-trip").addEventListener("click",function(t){getTrip()})}function addEventForm(e){document.querySelector(".".concat(e,"-form")).addEventListener("submit",function(t){t.preventDefault(),getLocationsList(t.target[0].value,"".concat(e,"s")),t.target[0].value=""}),document.querySelector(".".concat(e,"s")).addEventListener("click",function(t){"DIV"===t.target.nodeName&&setSelected(t.target.parentNode,"".concat(e,"s")),"LI"===t.target.nodeName&&setSelected(t.target,"".concat(e,"s"))})}function setSelected(t,e){var n=document.querySelector(".".concat(e," > .selected"));null!==n&&n.classList.remove("selected"),t.classList.add("selected"),validateEqualLocations(document.querySelector(".bus-container"))}function getTrip(){var t=document.querySelector(".origins > .selected"),e=document.querySelector(".destinations > .selected");getTripPlans(t.dataset.lat,t.dataset.long,e.dataset.lat,e.dataset.long)}function validateEqualLocations(t){var e=document.querySelector(".origins > .selected"),n=document.querySelector(".destinations > .selected");null!==e&&null!==n&&(e.dataset.lat===n.dataset.lat&&e.dataset.long===n.dataset.long?(t.innerHTML='<ul class="my-trip wrong-location"> <strong>Please select two different locations.</strong></ul>',document.querySelector(".plan-trip").disabled=!0):(t.innerHTML="",document.querySelector(".plan-trip").disabled=!1))}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},main();